// http://www.brighthub.com/internet/web-development/articles/96425.aspx

var request = require('request');

module.exports = function(uri,callback1,callback2,callback3,timeout) {
if(timeout==undefined) timeout=5000;//wait five seconds
return {
	timer:null,
	init:function() {
var self = this;
 //console.log("ping",uri,timeout);
		callback1();
                this.callback2 = callback2;
                this.callback3 = callback3;
		var session = new Date();
		var dontCache = session.getTime();
		var imgLink = uri+"?time="+dontCache;//prevent JavaScript from using cached image
                request({url:imgLink}, function(err,res,body) {
                  //console.log(err);
                  if(!err && (res.statusCode === 200||res.statusCode==302)) {
                      if(self.timer!=null) { // otherwise, already timed out
			clearTimeout(self.timer);

			self.timer = null;
			self.callback3();//			alert("Domain is available");
                      }
                  }
                });
		this.timer = setTimeout(function() { self.pingFailure(); },timeout);
//console.log("Timer",this.timer);
	},
	pingFailure:function() {

		clearTimeout(this.timer);

		this.timer = null;
		this.callback2(); //alert("Domain is not available");
	}
};
}
